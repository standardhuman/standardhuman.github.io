<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style media="screen" src="/styles.css" />
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript">
        // json.parse
        // map, filter, split

        var request = require('request');
        var url = "http://www.istocknow.com/live/live.php?type=7Plus&operator=tmobile&color=black&model=128GB&ajax=1&nocache=1476765128664&nobb=false&notarget=false&noradioshack=false&nostock=false"

        var istock, iArr;
        var arr = [];
        var pureObjs = [];
        var liveOnly = [];

        function valuesToArray(obj) {
            return Object.keys(obj).map(function(key) {
                return obj[key];
            });
        };
        $(document).ready(function() {
                    $('#go_button').click(request({
                            url: url,
                            json: true
                        }, function(error, response, body) {
                            if (!error && response.statusCode === 200) {
                                iArr = valuesToArray(body);
                                for (var i = 0; i < iArr.length; i++) {
                                    if (typeof iArr[i] === 'object') {
                                        arr.push(iArr[i]);
                                    };
                                };
                                arr.forEach(function(element) {
                                    for (var obj in element) {
                                        pureObjs.push(element[obj]);
                                    };
                                });
                                for (var i = 0; i < pureObjs.length; i++) {
                                    if (pureObjs[i].live !== '0') {
                                        liveOnly.push(pureObjs[i].title);
                                    }
                                }
                                console.log("All available locations: ", liveOnly, ".");
                                for (var i = 0; i < liveOnly.length; i++) {
                                    if (liveOnly[i] === '4th Street' || liveOnly[i] === 'Emeryville' || liveOnly[i] === 'San Francisco') {
                                        console.log("BINGO! Phone is available at ", liveOnly);
                                    } else {
                                        console.log("Nothing found in Berkeley or Emeryville");
                                        return;
                                    }
                                }
                            } else {
                                console.log("error");
                            }
                        });
                    });
    </script>
    <title>myStock Custom iPhone 7 Inventory search</title>
</head>

<body>
    <p>TEST</p>
    <div class="go_button">
        <button id="go_button" type="button" name="button">Go</button>
    </div>
    <form class="output">
        <div id="output">

        </div>
    </form>
</body>

</html>
